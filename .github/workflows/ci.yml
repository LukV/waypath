name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    name: Run Lint, Type Checks
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout source
      - name: "ğŸ§¾ Checkout repository"
        uses: actions/checkout@v4

      # 2. Install Poetry *before* setupâ€‘python so the builtâ€‘in cache can find it
      - name: "ğŸ“¦ Install Poetry"
        uses: snok/install-poetry@v1
        with:
          version: latest          # pin if you prefer a specific version
          virtualenvs-create: false # we'll let setupâ€‘python provide the interpreter

      # 3. Set up the desired Python version and enable Poetry cache
      - name: "âš™ï¸ Set up Python 3.12"
        id: python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: poetry
          cache-dependency-path: poetry.lock  # speeds up cache hits

      # 4. (Optional) force Poetry to use the interpreter we just installed
      - name: "ğŸ Select Python for Poetry"
        run: poetry env use "${{ steps.python.outputs.python-path }}"

      # 5. Install dependencies & run checks
      - name: "ğŸ“¥ Install dependencies (no root install)"
        run: poetry install --no-root

      - name: "ğŸ§¹ Ruff (lint + format)"
        run: poetry run ruff check --output-format=github

      - name: "ğŸ” MyPy (type checks)"
        run: poetry run mypy .
